# 🚀 IOCP GameServer 성능 측정 가이드 (30개 클라이언트)

## 📊 측정할 핵심 지표들

### 1. **서버 성능 지표**
- **TPS (Transactions Per Second)**: 서버가 처리하는 트랜잭션 수
- **패킷 처리 시간**: 평균/최대 패킷 처리 시간
- **메모리 사용량**: 힙 메모리 + 풀 메모리
- **연결된 클라이언트 수**: 실시간 연결 상태
- **패킷 송수신 통계**: 총 패킷 수, Move/Chat 패킷 수

### 2. **클라이언트 성능 지표**
- **클라이언트 TPS**: 각 클라이언트가 보내는 패킷 수
- **응답 시간**: 서버 응답 지연 시간
- **연결 상태**: 연결 성공/실패 통계
- **패킷 전송 성공율**: 패킷 손실률

## 🎯 목표 성능 지표

### **클라이언트 수별 예상 TPS**
```
클라이언트 수 | Move TPS | Chat TPS | 총 TPS | 예상 부하
------------|----------|----------|--------|----------
5개         | 20       | 2.5      | 22.5   | 낮음
10개        | 40       | 5.0      | 45.0   | 보통
15개        | 60       | 7.5      | 67.5   | 중간
20개        | 80       | 10.0     | 90.0   | 높음
25개        | 100      | 12.5     | 112.5  | 매우 높음
30개        | 120      | 15.0     | 135.0  | 최대
```

**계산 방식:**
- Move 패킷: 250ms 간격 = 4 TPS/클라이언트
- Chat 패킷: 2000ms 간격 = 0.5 TPS/클라이언트

### **좋은 성능 기준**

#### 🟢 **우수한 성능**
- **응답 시간**: < 10ms
- **메모리 사용량**: 안정적 (메모리 리크 없음)
- **CPU 사용률**: < 70%
- **연결 성공률**: 100%
- **패킷 손실률**: 0%
- **TPS 선형 증가**: 클라이언트 수에 비례

#### 🟡 **양호한 성능**
- **응답 시간**: 10-50ms
- **메모리 사용량**: 완만한 증가
- **CPU 사용률**: 70-85%
- **연결 성공률**: > 95%
- **패킷 손실률**: < 1%
- **TPS 증가율**: 80% 이상 선형

#### 🔴 **주의 필요**
- **응답 시간**: > 50ms
- **메모리 사용량**: 급격한 증가 또는 리크
- **CPU 사용률**: > 85%
- **연결 성공률**: < 95%
- **패킷 손실률**: > 1%
- **TPS 포화**: 클라이언트 증가해도 TPS 증가 안됨

## 📈 Grafana 대시보드에서 확인할 항목

### **실시간 모니터링**
1. **연결된 클라이언트 수** - 실시간 연결 상태
2. **서버 TPS** - 초당 처리 트랜잭션 수
3. **패킷 처리 시간** - 평균/최대 처리 시간
4. **메모리 사용량** - 힙/풀 메모리 사용량
5. **패킷 송수신 통계** - Move/Chat 패킷 분포

### **성능 분석 포인트**
- **선형 증가**: TPS가 클라이언트 수에 비례해서 증가하는가?
- **안정성**: 메모리 사용량이 안정적인가?
- **응답성**: 처리 시간이 일정 수준 유지되는가?
- **포화점**: 몇 개 클라이언트에서 성능이 포화되는가?

## 🔍 단계별 측정 방법

### **1단계: 환경 준비**
```bash
cd iocp_server_cpp/LoadTest
restart_monitoring.bat  # Docker 환경 재시작
```

### **2단계: 부하테스트 실행**
```bash
gradual_load_test.bat
```

### **3단계: 실시간 모니터링**
- Grafana: `http://localhost:3000` (admin/admin)
- Prometheus: `http://localhost:9090/targets`

### **4단계: 성능 분석**
- 각 5개 클라이언트 단위로 10초간 성능 측정
- 30개 클라이언트까지 점진적 증가
- 성능 저하 구간 식별

## 🎯 성능 목표 달성 기준

### **Pass 조건 (30개 클라이언트)**
- ✅ 총 TPS ≥ 130 (목표: 135)
- ✅ 평균 응답 시간 < 20ms
- ✅ 메모리 사용량 안정
- ✅ 연결 성공률 100%
- ✅ 패킷 손실률 0%

### **Excellent 조건**
- 🏆 총 TPS ≥ 135
- 🏆 평균 응답 시간 < 10ms
- 🏆 CPU 사용률 < 70%
- 🏆 모든 클라이언트 안정 연결
- 🏆 선형 성능 증가

## 📋 체크리스트

### **테스트 전 확인사항**
- [ ] GameServer 빌드 완료 (Release 모드)
- [ ] DummyClientCS 빌드 완료
- [ ] Docker 환경 정상 실행
- [ ] Prometheus 설정 확인 (포트 10001)
- [ ] Grafana 대시보드 로드 확인

### **테스트 중 모니터링**
- [ ] 실시간 TPS 증가 확인
- [ ] 메모리 사용량 모니터링
- [ ] 연결 상태 확인
- [ ] 응답 시간 변화 관찰
- [ ] 오류 발생 여부 확인

### **테스트 후 분석**
- [ ] 최대 TPS 기록
- [ ] 성능 저하 시점 파악
- [ ] 메모리 리크 여부 확인
- [ ] 포화점 분석
- [ ] 개선 방안 도출

## 💡 성능 개선 팁

### **서버 최적화**
- IOCP 워커 스레드 수 조정
- 메모리 풀 크기 최적화
- 패킷 처리 로직 개선
- 데이터베이스 쿼리 최적화

### **클라이언트 최적화**
- 패킷 전송 간격 조정
- 연결 재시도 로직 개선
- 메모리 관리 최적화

이 가이드를 참고하여 체계적인 성능 테스트를 진행하고 최적의 성능을 달성하세요! 🚀 